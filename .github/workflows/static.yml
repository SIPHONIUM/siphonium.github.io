name: Generate sitemap.xml in main branch

on:
  push:
    branches: [main]

permissions:
  contents: write  # Important pour push sur main !

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout main branch
      uses: actions/checkout@v3
      with:
        persist-credentials: true
        fetch-depth: 0  # n√©cessaire pour push

    - name: Generate sitemap.xml
      run: |
        echo '<?xml version="1.0" encoding="UTF-8"?>' > sitemap.xml
        echo '<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">' >> sitemap.xml

        echo '<url><loc>https://siphonium.github.io/</loc><lastmod>2025-07-24</lastmod><changefreq>monthly</changefreq><priority>1.0</priority></url>' >> sitemap.xml
        echo '<url><loc>https://siphonium.github.io/fr/</loc><changefreq>weekly</changefreq></url>' >> sitemap.xml
        echo '<url><loc>https://siphonium.github.io/fr/shop</loc><lastmod>2025-07-24</lastmod><changefreq>weekly</changefreq></url>' >> sitemap.xml
        echo '<url><loc>https://siphonium.github.io/fr/launcher</loc><lastmod>2025-07-24</lastmod><priority>0.5</priority></url>' >> sitemap.xml
        echo '<url><loc>https://siphonium.github.io/fr/credit</loc><lastmod>2025-07-24</lastmod></url>' >> sitemap.xml

        echo '</urlset>' >> sitemap.xml

    - name: Commit and push sitemap.xml
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"

        git add sitemap.xml
        git commit -m "üó∫Ô∏è Auto-g√©n√©ration du sitemap.xml" || echo "Rien √† commit"
        git push origin main
